{% load static %}
{% load url from future %}
<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" type="text/css" />

  <link rel="stylesheet" href="{% static "bootstrap/css/bootstrap.min.css" %}" type="text/css" />
  <link rel="stylesheet" href="{% static "css/openlayers.css" %}" type="text/css" /> 
  <link rel="stylesheet" href="{% static "css/prahounakole.css" %}" type="text/css" />
  <link rel="stylesheet" href="{% static "css/google.css" %}" type="text/css" />
  <link rel="stylesheet" href="{% static "css/layerswitcher.css" %}" type="text/css" />
  {% if mesto.sektor.slug != "mapa" and mesto.sektor.slug != "devel" %}
  <link rel="stylesheet" href="{% static "css/dpnk.css" %}" type="text/css" />
  {% endif %}
                    
  <link rel="stylesheet" href="{% static "css/print.css" %}" type="text/css" media="print" />
  {% if mobilni %}
   <link rel="stylesheet" href="{% static "css/mobile.css" %}" type="text/css" />
  {% endif %}
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
   <script type="text/javascript" src="{% static "bootstrap/js/bootstrap.min.js" %}"></script> <!-- Bootstrap musi byt hned za Jquery, resp, pret tools apod. -->
   <script type="text/javascript" src="http://cdn.jquerytools.org/1.2.7/full/jquery.tools.min.js"></script>
   <!-- <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.min.js" type="text/javascript"></script> -->
   <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
   
   <script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.8&amp;sensor=false"></script>
   <script type="text/javascript" src="{% static "js/char_parameters.js" %}"></script>
   <script type="text/javascript" src="{% static "js/OpenLayers.js" %}"></script>
   <script type="text/javascript" src="{% static "js/OpenStreetMap.js" %}"></script>
   <script type="text/javascript" src="{% static "js/cs-CZ.js" %}"></script>
   <script type="text/javascript" src="{% static "js/jquery.ba-hashchange.min.js" %}"></script>
   <script type="text/javascript" src="{% static "js/search.js" %}"></script>
   <script type="text/javascript" src="{% static "js/csapi.js" %}"></script>
   <script type="text/javascript" src="{% static "js/mapa.js" %}"></script>

   <link rel="alternate" type="application/rss+xml" title="Novinky v mapě" href="{% url 'novinky_feed' %}" />
   <link rel="alternate" type="application/rss+xml" title="Uzavírky" href="{% url 'uzavirky_feed' %}" />
   <link rel="alternate" type="application/rss+xml" title="Nejnovější komentáře" href="{% url 'latest_comments_feed' %}" />

   {# comments #}
   <link rel="stylesheet" type="text/css" href="{% static "fluent_comments/css/ajaxcomments.css" %}" />

   {# comments - persist login values #}
   <script type="text/javascript" src="{% static "js/jquery.cookie.js" %}"></script>
   <script type="text/javascript" src="{% static "js/jquery.persist.js" %}"></script>

  <title>Mapa Prahou na kole - {{ mesto.sektor.nazev }} </title>

    <script type="text/javascript">

        var mapconfig = {};
        mapconfig['root_url'] = "{{ root_url }}";
        mapconfig['vrstvy'] = [];
        {% for v in vrstvy %}
            {% if center_poi.znacka.vrstva == v %}
                enabled = "True";
            {% else %}
                enabled = "{{v.enabled}}";
            {% endif %}
            mapconfig['vrstvy'].push(["{{v.name}}", "{% url 'kml_view' v.slug %}", enabled, "{{v.slug}}"]);
        {% endfor %} 
        mapconfig['basezoom'] = {{ mesto.zoom }};
        mapconfig['baselon'] = {{ mesto.geom.x }};
        mapconfig['baselat'] = {{ mesto.geom.y }};
        {% if center_poi %}
            mapconfig['zoom'] = 15;
            mapconfig['lon'] = {{ center_poi.geom.centroid.x }};
            mapconfig['lat'] = {{ center_poi.geom.centroid.y }};
            mapconfig['center_feature'] = {{ center_poi.id }};
        {% else %}
            mapconfig['zoom'] = mapconfig['basezoom'];
            mapconfig['lon'] = mapconfig['baselon'];
            mapconfig['lat'] = mapconfig['baselat'];
        {% endif %}
        
        {% if minimize_layerswitcher %}
            mapconfig['minimize_layerswitcher'] = true
        {% endif %}
        {% if mobilni %}
            mapconfig['mobilni'] = true;
        {% else %}
            mapconfig['mobilni'] = false;
        {% endif %}

    </script>

  </head>
  <body onload="init(mapconfig)">
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-22281359-2']);
      _gaq.push(['_trackPageview']);
          
      (function() {
    	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(ga, s);
      })();

       
    </script>
    <a id="layers-switch" data-toggle="modal" data-target="#modal-layer"></a>
      <div id="core" class="container">
        {% include "filter.svg" %}
        <div class="row">
          <div id="panel" class="col-md-3 col-sm-10">
            <div id="city_switch_holder">
             <a id="city-switch" data-toggle="modal" data-target="#modal-city"></a>
            </div>
            <a class="panel_switch" href="#">&#8676;</a>
            <!-- sprclej panel -->
            <div class="row dildo hide">
               <a class="home" href="http://mapa.prahounakole.cz"><img src="{% static "css/prazak.png" %}" alt="mapa.prahounakole.cz">
                </a>
            </div>

            <!-- Panel v plne krase -->
            <div class="row gold">
              <nav class="col-md-10 col-md-offset-1">
                <div class="row centred">
                  <div class="col-md-12 logo">
                    <a href="http://mapa.prahounakole.cz">Prahou na kole <img src="{% static "css/prazak.png" %}" alt="mapa.prahounakole.cz">
                    </a>
                  </div>
                  <div class="col-md-3">  
                    <a href="#" class="tab_switch active">
                      <span class="sprite mapa btn mode-btn"></span>
                      <label>Vyhledat</label>
                    </a>
                  </div>
                  <div class="col-md-3 ">  
                    <a href="#hledani" class="tab_switch">
                      <span class="sprite btn mode-btn hledani"></span>
                      <label>Vyhledat trasu</label>
                    </a>
                  </div>
                  <div class="col-md-3">
                    <a href="#informace" class="tab_switch">
                    <span class="sprite  btn mode-btn informace"></span>
                    <label>Informace</label>
                    </a>
                  </div>
                  <div class="col-md-3">  
                    <a href="#feedback" class="tab_switch">
                    <span class="sprite  btn mode-btn feedback"></span>
                    <label>Feedback</label>
                    </a>
                  </div>
                </div>
              </nav>
              <article>
                <div id="content" class="col-md-10 col-md-offset-1">
                  <!-- here comes the treasure -->
                  {% include "panel-mapa.html" %}
                  {% include "panel-hledani.html" %}
                  {% include "panel-informace.html" %}
                  {% include "panel-feedback.html" %}
                </div>
              </article>
            </div>
          </div>
          <div class="col-md-9 col-sm-2 map_holder">
            <div id="map" {% if nomenu %}class="fullscreen"{% endif %}></div>
          </div>
        </div>
      </div>

      {% include "modal-layers.html" %}

      <script>
          jQuery(document).ready(function($) {

            // --------  PANEL SWITCH ---------
            $('.panel_switch').click( function(event){
                // prevent default a (link) behavior
                event.preventDefault();
                // let tthe body know the change .. for next possible visual changes
               $('body').toggleClass('panel_minimized');
                  // stretch - extend panel container
                   $('#panel').toggleClass('minimized col-md-3 col-sm-2 col-sm-10');
                   // stretch - extend map container
                  $('.map_holder').toggleClass('col-md-12 col-md-9 col-sm-12 col-sm-2');
                  // show/hide panel content
                  $('.dildo, .gold').toggleClass('hide');
                // update map size
                setTimeout(function(){map.updateSize();},500);
            });
            // ------ CLOSE POI -----
            $('.close').live("click",function(){
              $('#poi_box').slideUp(400).hide(400)
            });
            // corect the map width on large screens
             // 1445
            function map_width_fix(){
              W_width = $(window).width();
              if(W_width > 1444){
                panel_width = $('#panel').width();
                $('.map_holder').css("width", W_width - panel_width);
              }
            }
            map_width_fix();

            $(window).resize(function(event) {
              /* Act on the event */
              map_width_fix()
            });

            // advanced menu in layers layer
            // live('click', function(event) {
            //   /* Act on the event */
            // });
            $('.baseLbl').on('click', function () {
              e.preventDefault();
              $('.baseLayersDiv').toggle();
            });
            $('.dataLbl').on('click', function () {
              e.preventDefault();
              $('.dataLayersDiv').toggle();
            });

          });
        </script>
  </body>
</html>
